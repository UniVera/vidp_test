<!-- Datei zur Darstellung aller Videovorlesungen als Liste -->
<?php
session_start();
?>
<div class="page-header">
    <h2><?php echo $this->title ?></h2>
</div>

<button type="button" id="filterButton" class="btn btn-success btn-lg btn-block" aria-pressed="true"
        data-toggle="collapse"
        data-target="#filter" style="margin-bottom: 30px">
    Filtern
</button>

<!-- Button "Filtern" ein-/ausblenden -->
<script language="javascript" type="text/javascript">
    $('#filterButton').on('click', function (e) {
        $('#filterButton').each(function () {
            if ($(this).hasClass('active')) {
                $(this).removeClass('active');
            } else {
                $(this).addClass('active');
            }
        })
    });
</script>

<?php

$lecturerQuery = "PREFIX ns4: <http://purl.org/vocommons/voaf#>" . PHP_EOL;
$lecturerQuery .= "PREFIX ns3: <http://ns.ontowiki.net/SysOnt/Site/>" . PHP_EOL;
$lecturerQuery .= "PREFIX ns2: <https://bmake.th-brandenburg.de/vidp#>" . PHP_EOL;
$lecturerQuery .= "PREFIX ns1: <https://schema.org/>" . PHP_EOL;
$lecturerQuery .= "PREFIX ns0: <http://rdfs.org/ns/void#>" . PHP_EOL;
$lecturerQuery .= "PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>" . PHP_EOL;
$lecturerQuery .= "PREFIX owl: <http://www.w3.org/2002/07/owl#>" . PHP_EOL;
$lecturerQuery .= "PREFIX foaf: <http://xmlns.com/foaf/0.1/>" . PHP_EOL;
$lecturerQuery .= "PREFIX sysont: <http://ns.ontowiki.net/SysOnt/>" . PHP_EOL;
$lecturerQuery .= "PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>" . PHP_EOL;
$lecturerQuery .= "SELECT DISTINCT ?lecturer" . PHP_EOL;
$lecturerQuery .= "WHERE {" . PHP_EOL;

$lecturerQuery .= "?lecturerURI a ns2:Lecturer;" . PHP_EOL;
$lecturerQuery .= "rdfs:label ?lecturer." . PHP_EOL;
$lecturerQuery .= "}" . PHP_EOL;

?>

<?php

$_SESSION['lecturers'] = array();
$this->querylist($lecturerQuery, 'vidp/types/videoLectureList/filterNames.phtml');

?>

<?php
$moduleQuery = "PREFIX vs: <http://www.w3.org/2003/06/sw-vocab-status/ns#>
                PREFIX ns4: <http://purl.org/vocommons/voaf#>
                PREFIX ns3: <http://ns.ontowiki.net/SysOnt/Site/>
                PREFIX ns2: <https://bmake.th-brandenburg.de/vidp#>
                PREFIX ns1: <https://schema.org/>
                PREFIX vide: <https://bmake.th-brandenburg.de/vide#>
                PREFIX ns0: <http://rdfs.org/ns/void#>
                PREFIX vidp: <https://bmake.th-brandenburg.de/vidp#>
                PREFIX wd: <http://www.wikidata.org/entity/>
                PREFIX schema: <https://schema.org/>
                PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
                PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
                PREFIX owl: <http://www.w3.org/2002/07/owl#>
                PREFIX foaf: <http://xmlns.com/foaf/0.1/>
                PREFIX sysont: <http://ns.ontowiki.net/SysOnt/>
                PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
                SELECT DISTINCT ?module
                WHERE {
                ?moduleUri a ns2:Module;
                rdfs:label ?module.
                }";
?>

<?php

$_SESSION['modules'] = array();
$this->querylist($moduleQuery, 'vidp/types/videoLectureList/filterNames.phtml');

?>

<div id="filter" class="collapse jumbotron container-fluid">
    <div class="row">
        <form method="GET" id="filter_form">
            <div class="col-md-4 col-sm-6">
                <table class="table responsive">

                    <thead>
                    <tr>
                        <th class="text-left">Sprache</th>
                    </tr>
                    </thead>
                    <tr>
                        <td>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="en"
                                       name="checkEn" <?php echo($_GET["checkEn"] == "en" ? "checked" : "") ?>>
                                <label class="form-check-label" for="checkEn">
                                    Englisch
                                </label>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="de"
                                       name="checkDe" <?php echo($_GET["checkDe"] == "de" ? "checked" : "") ?>>
                                <label class="form-check-label" for="checkDe">
                                    Deutsch
                                </label>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="col-md-4 col-sm-6">
                <table class="table responsive">
                    <thead>
                    <tr>
                        <th class="text-left">DozentIn</th>
                    </tr>
                    </thead>
                    <?php
                    for ($i = 0; $i < count($_SESSION['lecturers']); $i++) {
                        $currentLecturer = $_SESSION['lecturers'][$i];
                        $currentCheckBoxName = "checkLecturer" . ($i + 1);
                        $currentCheckBox = '<tr>';
                        $currentCheckBox .= '<td>';
                        $currentCheckBox .= '<div class="form-check">';
                        $currentCheckBox .= '<input class="form-check-input" type="checkbox" value="' . $currentLecturer . '"';
                        $currentCheckBox .= 'name="' . $currentCheckBoxName . '"' . ($_GET[$currentCheckBoxName] == $currentLecturer ? "checked" : "") . '>';
                        $currentCheckBox .= '<label class="form-check-label" for=' . $currentCheckBoxName . '>';
                        $currentCheckBox .= '&nbsp;' . $currentLecturer;
                        $currentCheckBox .= '</label>';
                        $currentCheckBox .= '</div>';
                        $currentCheckBox .= '</td>';
                        $currentCheckBox .= '</tr>';
                        echo $currentCheckBox;
                    }
                    ?>

                </table>
            </div>

            <div class="col-md-4">
                <table class="table responsive">
                    <thead>
                    <tr>
                        <th class="text-left">Modul</th>
                    </tr>
                    </thead>
                    <tr>
                        <td>
                            <select class="form-control responsive" name="module" form="filter_form">
                                <?php
                                echo "<option value=''>--Bitte wählen Sie ein Modul aus--</option>";
                                for ($i = 0; $i < count($_SESSION['modules']); $i++) {
                                    $currentModule = $_SESSION['modules'][$i];
                                    $currentOption = '<option value="' . $currentModule . '" ' . ($_GET['module'] == $currentModule ? "selected" : "") . '>' . $currentModule . '</option>';
                                    echo $currentOption;
                                }
                                ?>
                            </select>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="row" align="center">
                <button type="submit" class="btn btn-primary">Filter anwenden</button>
            </div>
        </form>
    </div>

</div>

<div class="jumbotron">
    <?php
    $videoLectureElementQuery = 'PREFIX vidp: <https://bmake.th-brandenburg.de/vidp#>' . PHP_EOL;
    $videoLectureElementQuery .= 'PREFIX schema: <https://schema.org/>' . PHP_EOL;
    $videoLectureElementQuery .= 'PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>' . PHP_EOL;
    $videoLectureElementQuery .= 'SELECT DISTINCT ?videoLecture ?headline ?thumbnail ?label ?description ?language' . PHP_EOL;
    $videoLectureElementQuery .= 'WHERE { ?videoLecture a vidp:VideoLecture ;' . PHP_EOL;
    $videoLectureElementQuery .= 'schema:description ?description ;' . PHP_EOL;
    $videoLectureElementQuery .= 'schema:thumbnail ?logo ;' . PHP_EOL;
    $videoLectureElementQuery .= 'schema:inLanguage ?language ;' . PHP_EOL;
    $videoLectureElementQuery .= 'rdfs:label ?label ;' . PHP_EOL;
    $videoLectureElementQuery .= 'schema:headline ?headline .' . PHP_EOL;
    $videoLectureElementQuery .= '?logo schema:identifier ?thumbnail .' . PHP_EOL;
    $videoLectureElementQuery .= '?videoLecture a vidp:VideoLecture;
                   schema:about ?modul.';
    $videoLectureElementQuery .= '?modul a vidp:Module;
          rdfs:label ?modul_label.';
    $videoLectureElementQuery .= 'FILTER ( lang(?headline) = "de" ) .' . PHP_EOL;
    $videoLectureElementQuery .= '?doubleClip schema:isPartOf ?videoLecture .' . PHP_EOL;

    $lecturerChecked = false;
    $lecturerCount = count($_SESSION['lecturers']);
    #Diese for Schleife kontrolliert if eine der Checkboxes für die Filterfunktion "Lecturer" markiert wurde.
    for ($i = 0; $i < $lecturerCount; $i++) {
        if ($_GET["checkLecturer" . ($i + 1)] != "") {
            $lecturerChecked = true;
        }
    }
    #Dieser Block wird nur ausgeführt, falls eine der Checkboxes für die Filterfunktion "Lecturer" markiert ist.
    if ($lecturerChecked) {
        $videoLectureElementQuery .= '{
       	 ?doubleClip schema:creator ?creator.
         ?creator rdfs:label ?nameCreator.
         FILTER (';
        #Durch diese for Schleife sichergestellt, dass mehrere Dozenten ausgewählt werden können
        for ($i = 0; $i < $lecturerCount; $i++) {
            $videoLectureElementQuery .= 'contains( ?nameCreator, "' . $_GET["checkLecturer" . ($i + 1)] . '" )';
            if ($i < $lecturerCount - 1) {
                $videoLectureElementQuery .= ' || ';
            }
        }
        $videoLectureElementQuery .=
            ')}
       UNION { 
         ?doubleClip schema:contributor ?contributor. 
         ?contributor rdfs:label ?nameContributor. 
         FILTER (';
        #Durch diese for Schleife sichergestellt, dass mehrere Dozenten ausgewählt werden können
        for ($i = 0; $i < $lecturerCount; $i++) {
            $videoLectureElementQuery .= 'contains( ?nameContributor, "' . $_GET["checkLecturer" . ($i + 1)] . '" )';
            if ($i < $lecturerCount - 1) {
                $videoLectureElementQuery .= ' || ';
            }
        }
        $videoLectureElementQuery .=
            ')}' . PHP_EOL;
    }

    if ($_GET["checkEn"] != "" || $_GET["checkDe"] != "") {  //Query für Filterfunktion "Sprache"
        $videoLectureElementQuery .= 'FILTER ( (?language ="' . $_GET["checkEn"] . '") 
            || (?language ="' . $_GET["checkDe"] . '") ) .' . PHP_EOL;
    }
    if ($_GET['module'] != "") {
        $videoLectureElementQuery .= 'FILTER (contains(?modul_label, "' . $_GET['module'] . '"))';
    }
    $videoLectureElementQuery .= '}' . PHP_EOL;
    $videoLectureElementQuery .= 'ORDER BY ?videoLecture' . PHP_EOL;
    ?>

    <?=
    # $this->querylist($videoLectureElementQuery, 'vidp/types/videoLectureElement.phtml', array(), array('prefix' => '<li>', 'suffix' => '</li>'))

    #Hier wird kontrolliert, ob die angewendte Query mindestens eine Vorlesung zurückgibt. Falls nicht, wird eine Nachricht angezeigt.
    $result = $this->querylist($videoLectureElementQuery, 'vidp/types/videoLectureList/videoLectureElement.phtml', array());
    if ($result == "") {
        echo "<h3>Es gibt keine Videovorlesung für die von Ihnen ausgewählten Filtern.</h3>";
    }
    ?>


</div>
